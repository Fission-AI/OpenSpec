# 实现任务清单

## 1. 语言检测工具类
- [x] 1.1 创建 `src/utils/language-detector.ts` 文件
- [x] 1.2 实现 `detectLanguage()` 方法，支持多种检测方式
- [x] 1.3 实现 `containsChinese()` 辅助方法，检测文本中的中文字符
- [x] 1.4 实现 `detectFromEnvironment()` 方法，从环境变量检测语言
- [x] 1.5 实现 `detectFromFile()` 方法，从现有文件内容推断语言
- [x] 1.6 添加语言检测的优先级逻辑
- [x] 1.7 实现语言代码标准化功能，支持多种格式：
  - 标准格式：`zh-CN` → `zh-CN`，`en-US` → `en-US`
  - 小写格式：`zh-cn` → `zh-CN`，`en-us` → `en-US`
  - 简化格式：`zh` → `zh-CN`，`en` → `en-US`
  - 环境变量格式：`zh_CN.UTF-8` → `zh-CN`，`zh_cn.UTF-8` → `zh-CN`

## 2. UpdateCommand 核心修改
- [x] 2.1 修改 `UpdateCommand` 构造函数，添加语言参数支持
- [x] 2.2 在 `execute()` 方法中集成语言检测逻辑
- [x] 2.3 修改 AGENTS.md 更新逻辑，根据语言选择模板
- [x] 2.4 确保所有模板更新都使用一致的语言
- [x] 2.5 添加语言检测的日志输出

## 3. 模板管理器增强
- [x] 3.1 确认 `TemplateManager.getAgentsStandardTemplate()` 支持语言参数
- [x] 3.2 验证现有的语言模板选择逻辑
- [x] 3.3 确保所有相关模板都支持多语言

## 4. CLI 接口更新
- [x] 4.1 在 `src/cli/index.ts` 中为 update 命令添加 `--language` 选项
- [x] 4.2 添加语言选项的验证逻辑，支持 `en` 和 `zh-CN`
- [x] 4.3 更新命令帮助文档，说明语言选项的用法
- [x] 4.4 确保与 init 命令的语言选项保持一致

## 5. 测试覆盖
- [x] 5.1 为 `LanguageDetector` 编写单元测试
  - [x] 5.1.1 测试命令行参数检测
  - [x] 5.1.2 测试文件内容检测（中文字符识别）
  - [x] 5.1.3 测试环境变量检测
  - [x] 5.1.4 测试默认回退逻辑
- [x] 5.2 为 `UpdateCommand` 语言支持编写测试
  - [x] 5.2.1 测试中文项目更新保持中文
  - [x] 5.2.2 测试英文项目更新保持英文
  - [x] 5.2.3 测试命令行参数覆盖检测结果
- [x] 5.3 添加集成测试覆盖端到端场景
- [x] 5.4 测试向后兼容性，确保现有项目不受影响

## 6. 规格文档更新
- [x] 6.1 更新 `specs/cli-update/spec.md`，添加语言支持规格
- [x] 6.2 说明语言检测的优先级和逻辑
- [x] 6.3 添加使用示例和边界情况说明
- [x] 6.4 更新命令行选项的文档

## 7. 错误处理和边界情况
- [x] 7.1 处理文件读取失败的情况
- [x] 7.2 处理无效语言参数的错误提示
- [x] 7.3 处理环境变量格式异常的情况
- [x] 7.4 添加语言检测失败时的回退机制

## 8. 性能和优化
- [x] 8.1 优化文件内容检测的性能（避免读取大文件）
- [x] 8.2 添加语言检测结果的缓存机制
- [x] 8.3 确保语言检测不影响 update 命令的执行速度

## 9. 文档和示例
- [x] 9.1 更新 CLI 帮助文档
- [x] 9.2 添加使用示例到项目文档
- [x] 9.3 说明与 init 命令的语言选项一致性
- [x] 9.4 添加故障排除指南