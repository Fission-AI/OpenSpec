# 验证命令

## 新增要求

### 要求：验证应提供可操作的补救步骤
验证输出应包含修复每个错误的具体指导，包括期望的结构、示例标题和建议的命令以验证修复。

#### 场景：变更中未找到增量
- **当** 验证零个解析增量的变更时
- **则** 显示错误"未找到增量"并提供指导：
  - 确保 `openspec/changes/{id}/specs/` 存在 `.md` 文件
  - 使用增量标题：`## ADDED Requirements`、`## MODIFIED Requirements`、`## REMOVED Requirements`、`## RENAMED Requirements`
  - 每个要求必须包含至少一个 `#### Scenario:` 块
  - 尝试：`openspec change show {id} --json --deltas-only` 以检查解析的内容

#### 场景：缺少必需部分
- **当** 缺少必需部分时
- **则** 验证器应包含期望的标题名称和最小骨架：
  - 对于规范：`## Purpose`、`## Requirements`
  - 对于变更：`## Why`、`## What Changes`
  - 显示缺失部分的示例片段

### 要求：验证器应检测可能格式错误的场景并发出带有修复的警告
验证器应识别看起来像场景的项目符号行（例如，以 WHEN/THEN/AND 开头的行），并发出带有转换示例到 `#### Scenario:` 的定向警告。

#### 场景：要求下的项目符号 WHEN/THEN
- **当** 在没有 `#### Scenario:` 标题的要求下找到以 WHEN/THEN/AND 开头的项目符号时
- **则** 发出警告："场景必须使用 '#### Scenario:' 标题"，并显示转换模板：
```
#### 场景：简短名称
- **当** ...
- **则** ...
- **并且** ...
```

### 要求：所有问题应包含文件路径和结构化位置
错误、警告和信息消息应包含：
- 源文件路径（`openspec/changes/{id}/proposal.md`、`.../specs/{cap}/spec.md`）
- 结构化路径（例如，`deltas[0].requirements[0].scenarios`）

#### 场景：Zod 验证错误
- **当** 模式验证失败时
- **则** 消息应包含 `file`、`path`，以及适用的补救提示

### 要求：无效结果应在人类可读输出中包含下一步页脚
当项目无效且未使用 `--json` 时，CLI 应在末尾附加下一步页脚，包括：
- 带计数的摘要行
- 前 3 个指导项目符号（针对最频繁或阻塞错误的上下文）
- 重新运行带 `--json` 和/或调试命令的建议

#### 场景：变更无效摘要
- **当** 变更验证失败时
- **则** 打印"下一步"带 2-3 个定向项目符号，并建议 `openspec change show <id> --json --deltas-only`