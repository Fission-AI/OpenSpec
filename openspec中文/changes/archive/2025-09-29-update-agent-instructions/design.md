# 设计：代理指令更新

## 方法

### 信息架构
- **前置关键信息** - 三阶段工作流优先
- **清晰的层次结构** - 核心工作流 → 快速开始 → 命令 → 详情 → 边缘情况
- **50% 长度减少** - 目标约 285 行，从当前约 575 行
- **祈使语气** - "创建提案" vs "你应该创建一个提案"
- **项目符号而非段落** - 可扫描，简洁的信息

### 三阶段工作流文档
工作流现在作为核心概念突出显示：
1. **创建** - 提案生成阶段
2. **实现** - 代码开发阶段，包含明确步骤：
   - 阅读 proposal.md 以理解
   - 阅读 design.md 以获取技术上下文
   - 阅读 tasks.md 以获取清单
   - 顺序实现任务
   - 每个任务完成后立即标记完成
3. **归档** - 部署后最终化阶段

此结构帮助代理理解生命周期及其在每个阶段的角色。实现阶段特别详细，以防止常见错误，如跳过文档或批量完成任务。

### CLI 文档更新
- **全面的命令覆盖** - 所有 9 个主要命令都有文档
- **`openspec list` 突出显示** - 用于发现变更和规范的关键命令
- **交互模式文档** - 代理如何有效使用提示
- **完整的标志文档** - 所有选项如 --json、--type、--skip-specs
- **弃用清理** - 删除名词优先模式（openspec change show）

### 代理特定增强
基于编码代理的行业最佳实践（Claude Code、Cursor 等）：

**实现工作流**
- 明确步骤防止跳过关键上下文
- 首先阅读提案/设计确保理解后再编码
- 顺序任务完成保持专注
- 立即标记防止丢失进度
- 解决常见失败模式：直接跳到代码

**规范发现工作流**
- 创建新规范前始终检查现有规范
- 使用 `openspec list --specs` 发现当前功能
- 优先修改现有规范而非创建重复规范
- 防止碎片化并保持连贯架构

**决策清晰度**
- 清晰的决策树消除模糊条件
- 每个决策分支的具体示例
- 简化的错误与功能确定

**工具使用指导**
- 工具选择矩阵（何时使用 Grep vs Glob vs Read）
- 常见失败的错误恢复模式
- 验证工作流确认正确性

**上下文管理**
- "任何任务之前"清单用于收集上下文
- 开始任何工作前要阅读的内容
- 如何在交互中保持状态

**规范文件结构文档**
- 带 ADDED/MODIFIED/REMOVED 部分的完整示例
- 关键场景格式化（#### Scenario: 标头）
- 增量文件位置清晰度（changes/{name}/specs/）
- 解决回顾中发现的最常见创建错误

**故障排除和调试**
- 带解决方案的常见错误消息
- 增量检测调试步骤
- 验证最佳实践
- 用于检查的 JSON 输出
- 防止静默失败造成的数小时挫折

**最佳实践**
- 保持简洁（适当时使用单行答案）
- 保持具体（file.ts:42 行引用）
- 从简单开始（<100 行，单文件默认）
- 为复杂性辩护（需要指标/数据）

## 设计原理

### 为什么这些变更很重要

**认知负荷减少**
- 代理在清晰结构下更好地处理指令
- 前置关键信息减少扫描时间
- 决策树消除分析瘫痪

**行业对齐**
- 遵循在 Claude Code、Cursor、GitHub Copilot 中证明有效的模式
- 解决常见失败模式（模糊决策、缺失上下文）
- 优化 LLM 优势（模式匹配）vs 弱点（计算）

**解决关键痛点（来自回顾）**
- **场景格式化** - 最大困扰，现在有明确文档和示例
- **完整规范结构** - 完整示例防止结构错误
- **增量检测问题** - 调试命令帮助诊断问题
- **静默解析失败** - 故障排除部分解释常见问题

**实际影响**
- 代理更快理解任务
- 更少的需求误解
- 更一致的实现质量
- 出错时更好的错误恢复
- 防止用户体验中识别的最常见错误

## 权衡

### 我们正在移除的内容
- 可以推断的概念的冗长解释
- 不增加清晰度的冗余示例
- 移至参考部分的冗长边缘情况文档
- 已弃用的命令文档

### 我们保留的内容
- 所有关键工作流步骤
- 完整的 CLI 命令参考
- 复杂性管理原则
- 目录结构可视化
- 快速参考摘要

## 实现说明

CLAUDE.md 模板有意比 README.md 更简洁，因为：
- 它出现在每个项目根目录
- 代理可以参考完整的 README.md 获取详情
- 它需要在 AI 上下文窗口中快速加载
- 重点是立即可操作的指导