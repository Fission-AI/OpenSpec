# 实现任务

## 1. 核心实现
- [ ] 1.1 创建 `src/core/archive.ts` 包含 ArchiveCommand 类
  - [ ] 1.1.1 实现变更选择（如果未提供则交互式选择）
  - [ ] 1.1.2 实现从 tasks.md 检查未完成任务
  - [ ] 1.1.3 实现未完成任务的确认提示
  - [ ] 1.1.4 实现规范更新功能
    - [ ] 1.1.4.1 检测变更目录中的规范
    - [ ] 1.1.4.2 与现有的主规范比较
    - [ ] 1.1.4.3 显示新规范 vs 更新规范的摘要
    - [ ] 1.1.4.4 显示规范更新的确认提示
    - [ ] 1.1.4.5 将规范复制到主规范目录
  - [ ] 1.1.5 实现带日期前缀的归档移动
  - [ ] 1.1.6 支持 --yes 标志以跳过确认

## 2. CLI 集成
- [ ] 2.1 在 `src/cli/index.ts` 中添加归档命令
  - [ ] 2.1.1 导入 ArchiveCommand
  - [ ] 2.1.2 使用 commander 注册命令
  - [ ] 2.1.3 添加 --yes/-y 标志选项
  - [ ] 2.1.4 添加适当的错误处理

## 3. 错误处理
- [ ] 3.1 处理缺失的 openspec/changes/ 目录
- [ ] 3.2 处理未找到的变更
- [ ] 3.3 处理归档目标已存在
- [ ] 3.4 处理用户取消

## 4. 测试
- [ ] 4.1 测试完全完成的变更
- [ ] 4.2 测试未完成任务（显示警告）
- [ ] 4.3 测试交互式选择模式
- [ ] 4.4 测试重复归档防护
- [ ] 4.5 测试规范更新功能
  - [ ] 4.5.1 测试创建新规范
  - [ ] 4.5.2 测试更新现有规范
  - [ ] 4.5.3 测试确认提示显示
  - [ ] 4.5.4 测试拒绝确认（无变更）
  - [ ] 4.5.5 测试 --yes 标志跳过确认

## 5. 构建和验证
- [ ] 5.1 确保 TypeScript 编译成功
- [ ] 5.2 测试命令执行