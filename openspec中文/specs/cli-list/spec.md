# 列表命令规范

## 目的

`openspec list` 命令应为开发人员提供项目中所有活动变更的快速概览，显示其名称和任务完成状态。

## 要求
### 要求：命令执行

命令应根据所选模式扫描和分析活动变更或规范。

#### 场景：扫描变更（默认）

- **当** 执行不带标志的 `openspec list` 时
- **则** 扫描 `openspec/changes/` 目录以查找变更目录
- **并** 从结果中排除 `archive/` 子目录
- **并** 解析每个变更的 `tasks.md` 文件以计算任务完成情况

#### 场景：扫描规范

- **当** 执行 `openspec list --specs` 时
- **则** 扫描 `openspec/specs/` 目录以查找功能
- **并** 读取每个功能的 `spec.md`
- **并** 解析需求以计算需求数量

### 要求：任务计数

命令应使用标准 Markdown 复选框模式准确计算任务完成状态。

#### 场景：在 tasks.md 中计数任务

- **当** 解析 `tasks.md` 文件时
- **则** 计算匹配以下模式的任务：
  - 已完成：包含 `- [x]` 的行
  - 未完成：包含 `- [ ]` 的行
- **并** 将总任务计算为已完成和未完成的总和

### 要求：输出格式

命令应以清晰、可读的表格格式显示项目，并包含适合模式的进度或计数。

#### 场景：显示变更列表（默认）

- **当** 显示变更列表时
- **则** 显示包含以下列的表格：
  - 变更名称（目录名称）
  - 任务进度（例如，"3/5 任务" 或 "✓ 完成"）

#### 场景：显示规范列表

- **当** 显示规范列表时
- **则** 显示包含以下列的表格：
  - 规范 ID（目录名称）
  - 需求数量（例如，"需求 12"）

### 要求：标志

命令应接受标志以选择要列出的名词。

#### 场景：选择规范

- **当** 提供 `--specs` 时
- **则** 列出规范而不是变更

#### 场景：选择变更

- **当** 提供 `--changes` 时
- **则** 明确列出变更（与默认行为相同）

### 要求：空状态

命令应在所选模式没有项目时提供清晰的反馈。

#### 场景：处理空状态（变更）

- **当** 不存在活动变更时（只有 archive/ 或空的 changes/）
- **则** 显示："未找到活动变更。"

#### 场景：处理空状态（规范）

- **当** 不存在规范目录或包含功能时
- **则** 显示："未找到规范。"

### 要求：错误处理

命令应优雅地处理缺失的文件和目录，并提供适当的消息。

#### 场景：缺失 tasks.md 文件

- **当** 变更目录没有 `tasks.md` 文件时
- **则** 显示带有"无任务"状态的变更

#### 场景：缺失变更目录

- **当** `openspec/changes/` 目录不存在时
- **则** 显示错误："未找到 OpenSpec 变更目录。请先运行 'openspec init'。"
- **并** 以代码 1 退出

### 要求：排序

命令应保持变更的一致排序，以获得可预测的输出。

#### 场景：排序变更

- **当** 显示多个变更时
- **则** 按变更名称的字母顺序排序

## 原因

开发人员需要一种快速的方式来：
- 查看正在进行的变更
- 识别哪些变更已准备好归档
- 了解整体项目演进状态
- 无需打开多个文件即可获得鸟瞰视图

此命令以最少的努力提供这种可见性，遵循 OpenSpec 的简洁和清晰哲学。