export const agentsTemplate = `# تعليمات OpenSpec

تعليمات لمساعدي الترميز بالذكاء الاصطناعي الذين يستخدمون OpenSpec للتطوير القائم على المواصفات.

## قائمة التحقق السريعة

- البحث عن العمل الموجود: \`openspec spec list --long\`، \`openspec list\` (استخدم \`rg\` فقط للبحث النصي الكامل)
- تحديد النطاق: قدرة جديدة مقابل تعديل قدرة موجودة
- اختيار \`change-id\` فريد: kebab-case، بقيادة فعل (\`add-\`، \`update-\`، \`remove-\`، \`refactor-\`)
- السقالة: \`proposal.md\`، \`tasks.md\`، \`design.md\` (فقط عند الحاجة)، ومواصفات دلتا لكل قدرة متأثرة
- كتابة الدلتا: استخدم \`## ADDED|MODIFIED|REMOVED|RENAMED Requirements\`؛ قم بتضمين سيناريو واحد على الأقل \`#### Scenario:\` لكل متطلب
- التحقق: \`openspec validate [change-id] --strict\` وإصلاح المشكلات
- طلب الموافقة: لا تبدأ التنفيذ حتى يتم الموافقة على المقترح

## سير العمل المكون من ثلاث مراحل

### المرحلة 1: إنشاء التغييرات
قم بإنشاء مقترح عندما تحتاج إلى:
- إضافة ميزات أو وظائف
- إجراء تغييرات كبيرة (API، المخطط)
- تغيير البنية أو الأنماط
- تحسين الأداء (يغير السلوك)
- تحديث أنماط الأمان

المحفزات (أمثلة):
- "ساعدني في إنشاء مقترح تغيير"
- "ساعدني في تخطيط تغيير"
- "أريد إنشاء مقترح"
- "أريد إنشاء مقترح مواصفات"
- "أريد إنشاء مواصفات"

إرشادات المطابقة الفضفاضة:
- يحتوي على أحد: \`proposal\`، \`change\`، \`spec\`
- مع أحد: \`create\`، \`plan\`، \`make\`، \`start\`، \`help\`

تخطي المقترح لـ:
- إصلاحات الأخطاء (استعادة السلوك المقصود)
- الأخطاء الإملائية، التنسيق، التعليقات
- تحديثات التبعيات (غير كبيرة)
- تغييرات التكوين
- اختبارات للسلوك الموجود

**سير العمل**
1. راجع \`openspec/project.md\`، \`openspec list\`، و \`openspec list --specs\` لفهم السياق الحالي.
2. اختر \`change-id\` فريد بقيادة فعل وأنشئ \`proposal.md\`، \`tasks.md\`، \`design.md\` اختياري، ودلتا المواصفات تحت \`openspec/changes/<id>/\`.
3. اكتب دلتا المواصفات باستخدام \`## ADDED|MODIFIED|REMOVED Requirements\` مع سيناريو واحد على الأقل \`#### Scenario:\` لكل متطلب.
4. قم بتشغيل \`openspec validate <id> --strict\` وحل جميع المشكلات قبل مشاركة المقترح.

### المرحلة 2: تنفيذ التغييرات
تتبع هذه الخطوات كـ TODOs وأكملها واحدة تلو الأخرى.
1. **اقرأ proposal.md** - افهم ما يتم بناؤه
2. **اقرأ design.md** (إن وجد) - راجع القرارات التقنية
3. **اقرأ tasks.md** - احصل على قائمة التحقق للتنفيذ
4. **نفذ المهام بالتسلسل** - أكمل بالترتيب
5. **أكد الإكمال** - تأكد من أن كل عنصر في \`tasks.md\` مكتمل قبل تحديث الحالات
6. **حدّث قائمة التحقق** - بعد اكتمال كل العمل، اضبط كل مهمة على \`- [x]\` بحيث تعكس القائمة الواقع
7. **بوابة الموافقة** - لا تبدأ التنفيذ حتى يتم مراجعة المقترح والموافقة عليه

### المرحلة 3: أرشفة التغييرات
بعد النشر، قم بإنشاء PR منفصل لـ:
- نقل \`changes/[name]/\` → \`changes/archive/YYYY-MM-DD-[name]/\`
- تحديث \`specs/\` إذا تغيرت القدرات
- استخدم \`openspec archive <change-id> --skip-specs --yes\` للتغييرات المتعلقة بالأدوات فقط (مرر معرف التغيير دائمًا بشكل صريح)
- قم بتشغيل \`openspec validate --strict\` لتأكيد أن التغيير المؤرشف يمر الفحوصات

## قبل أي مهمة

**قائمة التحقق السياقية:**
- [ ] اقرأ المواصفات ذات الصلة في \`specs/[capability]/spec.md\`
- [ ] تحقق من التغييرات المعلقة في \`changes/\` للتعارضات
- [ ] اقرأ \`openspec/project.md\` للاتفاقيات
- [ ] قم بتشغيل \`openspec list\` لرؤية التغييرات النشطة
- [ ] قم بتشغيل \`openspec list --specs\` لرؤية القدرات الموجودة

**قبل إنشاء المواصفات:**
- تحقق دائمًا مما إذا كانت القدرة موجودة بالفعل
- فضّل تعديل المواصفات الموجودة على إنشاء مكررات
- استخدم \`openspec show [spec]\` لمراجعة الحالة الحالية
- إذا كان الطلب غامضًا، اطرح 1-2 أسئلة توضيحية قبل السقالة

### إرشادات البحث
- تعداد المواصفات: \`openspec spec list --long\` (أو \`--json\` للنصوص البرمجية)
- تعداد التغييرات: \`openspec list\` (أو \`openspec change list --json\` - مهجور ولكن متاح)
- عرض التفاصيل:
  - المواصفات: \`openspec show <spec-id> --type spec\` (استخدم \`--json\` للمرشحات)
  - التغيير: \`openspec show <change-id> --json --deltas-only\`
- البحث النصي الكامل (استخدم ripgrep): \`rg -n "Requirement:|Scenario:" openspec/specs\`

## البدء السريع

### أوامر CLI

\`\`\`bash
# الأوامر الأساسية
openspec list                  # قائمة التغييرات النشطة
openspec list --specs          # قائمة المواصفات
openspec show [item]           # عرض التغيير أو المواصفات
openspec validate [item]       # التحقق من التغييرات أو المواصفات
openspec archive <change-id> [--yes|-y]   # أرشفة بعد النشر (أضف --yes للتشغيل غير التفاعلي)

# إدارة المشروع
openspec init [path]           # تهيئة OpenSpec
openspec update [path]         # تحديث ملفات التعليمات

# الوضع التفاعلي
openspec show                  # مطالبات للاختيار
openspec validate              # وضع التحقق المجمع

# التصحيح
openspec show [change] --json --deltas-only
openspec validate [change] --strict
\`\`\`

### أعلام الأوامر

- \`--json\` - إخراج قابل للقراءة آليًا
- \`--type change|spec\` - إزالة الغموض من العناصر
- \`--strict\` - التحقق الشامل
- \`--no-interactive\` - تعطيل المطالبات
- \`--skip-specs\` - أرشفة دون تحديثات المواصفات
- \`--yes\`/\`-y\` - تخطي مطالبات التأكيد (أرشفة غير تفاعلية)

## هيكل الدليل

\`\`\`
openspec/
├── project.md              # اتفاقيات المشروع
├── specs/                  # الحقيقة الحالية - ما تم بناؤه
│   └── [capability]/       # قدرة واحدة مركزة
│       ├── spec.md         # المتطلبات والسيناريوهات
│       └── design.md       # الأنماط التقنية
├── changes/                # المقترحات - ما يجب تغييره
│   ├── [change-name]/
│   │   ├── proposal.md     # لماذا، ماذا، التأثير
│   │   ├── tasks.md        # قائمة التحقق للتنفيذ
│   │   ├── design.md       # القرارات التقنية (اختياري؛ انظر المعايير)
│   │   └── specs/          # تغييرات دلتا
│   │       └── [capability]/
│   │           └── spec.md # ADDED/MODIFIED/REMOVED
│   └── archive/            # التغييرات المكتملة
\`\`\`

## إنشاء مقترحات التغيير

### شجرة القرار

\`\`\`
طلب جديد؟
├─ إصلاح خطأ يستعيد سلوك المواصفات؟ → إصلاح مباشر
├─ خطأ إملائي/تنسيق/تعليق؟ → إصلاح مباشر
├─ ميزة/قدرة جديدة؟ → إنشاء مقترح
├─ تغيير كبير؟ → إنشاء مقترح
├─ تغيير في البنية؟ → إنشاء مقترح
└─ غير واضح؟ → إنشاء مقترح (أكثر أمانًا)
\`\`\`

### هيكل المقترح

1. **إنشاء الدليل：** \`changes/[change-id]/\` (kebab-case، بقيادة فعل، فريد)

2. **كتابة proposal.md：**
\`\`\`markdown
# التغيير: [وصف موجز للتغيير]

## لماذا
[1-2 جملة حول المشكلة/الفرصة]

## ما الذي يتغير
- [قائمة نقطية للتغييرات]
- [ضع علامة على التغييرات الكبيرة بـ **BREAKING**]

## التأثير
- المواصفات المتأثرة: [اذكر القدرات]
- الكود المتأثر: [الملفات/الأنظمة الرئيسية]
\`\`\`

3. **إنشاء دلتا المواصفات：** \`specs/[capability]/spec.md\`
\`\`\`markdown
## ADDED Requirements
### Requirement: ميزة جديدة
يجب أن يوفر النظام...

#### Scenario: حالة النجاح
- **WHEN** يقوم المستخدم بإجراء
- **THEN** النتيجة المتوقعة

## MODIFIED Requirements
### Requirement: ميزة موجودة
[المتطلب المعدل الكامل]

## REMOVED Requirements
### Requirement: ميزة قديمة
**السبب**: [لماذا الإزالة]
**الترحيل**: [كيفية التعامل]
\`\`\`
إذا تأثرت قدرات متعددة، قم بإنشاء ملفات دلتا متعددة تحت \`changes/[change-id]/specs/<capability>/spec.md\`—واحد لكل قدرة.

4. **إنشاء tasks.md：**
\`\`\`markdown
## 1. التنفيذ
- [ ] 1.1 إنشاء مخطط قاعدة البيانات
- [ ] 1.2 تنفيذ نقطة نهاية API
- [ ] 1.3 إضافة مكون الواجهة الأمامية
- [ ] 1.4 كتابة الاختبارات
\`\`\`

5. **إنشاء design.md عند الحاجة：**
قم بإنشاء \`design.md\` إذا كان أي مما يلي ينطبق؛ وإلا فاحذفه:
- تغيير عابر (خدمات/وحدات متعددة) أو نمط معماري جديد
- تبعية خارجية جديدة أو تغييرات كبيرة في نموذج البيانات
- تعقيد الأمان أو الأداء أو الترحيل
- غموض يستفيد من القرارات التقنية قبل الترميز

هيكل \`design.md\` الأدنى:
\`\`\`markdown
## السياق
[الخلفية، القيود، أصحاب المصلحة]

## الأهداف / غير الأهداف
- الأهداف: [...]
- غير الأهداف: [...]

## القرارات
- القرار: [ماذا ولماذا]
- البدائل المدروسة: [الخيارات + المبرر]

## المخاطر / المقايضات
- [المخاطر] → التخفيف

## خطة الترحيل
[الخطوات، التراجع]

## الأسئلة المفتوحة
- [...]
\`\`\`

## تنسيق ملف المواصفات

### حرج: تنسيق السيناريو

**صحيح** (استخدم رؤوس ####):
\`\`\`markdown
#### Scenario: نجاح تسجيل دخول المستخدم
- **WHEN** يتم توفير بيانات اعتماد صالحة
- **THEN** إرجاع رمز JWT
\`\`\`

**خطأ** (لا تستخدم نقاط أو نص عريض):
\`\`\`markdown
- **Scenario: تسجيل دخول المستخدم**  ❌
**Scenario**: تسجيل دخول المستخدم     ❌
### Scenario: تسجيل دخول المستخدم      ❌
\`\`\`

يجب أن يكون لكل متطلب سيناريو واحد على الأقل.

### صياغة المتطلبات
- استخدم SHALL/MUST للمتطلبات المعيارية (تجنب should/may ما لم يكن غير معياري عن قصد)

### عمليات دلتا

- \`## ADDED Requirements\` - قدرات جديدة
- \`## MODIFIED Requirements\` - سلوك معدل
- \`## REMOVED Requirements\` - ميزات مهجورة
- \`## RENAMED Requirements\` - تغييرات الأسماء

رؤوس مطابقة لـ \`trim(header)\` - يتم تجاهل المسافات البيضاء.

#### متى تستخدم ADDED مقابل MODIFIED
- ADDED: يقدم قدرة جديدة أو قدرة فرعية يمكن أن تقف بمفردها كمتطلب. فضّل ADDED عندما يكون التغيير متعامدًا (على سبيل المثال، إضافة "تكوين أمر slash") بدلاً من تغيير دلالات متطلب موجود.
- MODIFIED: يغير السلوك أو النطاق أو معايير القبول لمتطلب موجود. الصق دائمًا محتوى المتطلب الكامل والمحدث (الرأس + جميع السيناريوهات). سيستبدل الأرشيف المتطلب بالكامل بما توفره هنا؛ ستسقط دلتا الجزئية التفاصيل السابقة.
- RENAMED: استخدم عندما يتغير الاسم فقط. إذا قمت أيضًا بتغيير السلوك، استخدم RENAMED (الاسم) بالإضافة إلى MODIFIED (المحتوى) مع الإشارة إلى الاسم الجديد.

فخ شائع: استخدام MODIFIED لإضافة قلق جديد دون تضمين النص السابق. يتسبب هذا في فقدان التفاصيل في وقت الأرشفة. إذا لم تقم بتغيير المتطلب الموجود صراحة، أضف متطلبًا جديدًا تحت ADDED بدلاً من ذلك.

كتابة متطلب MODIFIED بشكل صحيح:
1) حدد موقع المتطلب الموجود في \`openspec/specs/<capability>/spec.md\`.
2) انسخ كتلة المتطلب بالكامل (من \`### Requirement: ...\` عبر سيناريوهاته).
3) الصقه تحت \`## MODIFIED Requirements\` وقم بتحريره ليعكس السلوك الجديد.
4) تأكد من تطابق نص الرأس تمامًا (غير حساس للمسافات البيضاء) واحتفظ بسيناريو واحد على الأقل \`#### Scenario:\`.

مثال لـ RENAMED:
\`\`\`markdown
## RENAMED Requirements
- FROM: \`### Requirement: Login\`
- TO: \`### Requirement: User Authentication\`
\`\`\`

## استكشاف الأخطاء وإصلاحها

### الأخطاء الشائعة

**"يجب أن يكون للتغيير دلتا واحدة على الأقل"**
- تحقق من وجود \`changes/[name]/specs/\` مع ملفات .md
- تحقق من أن الملفات تحتوي على بادئات العمل (## ADDED Requirements)

**"يجب أن يكون للمتطلب سيناريو واحد على الأقل"**
- تحقق من أن السيناريوهات تستخدم تنسيق \`#### Scenario:\` (4 علامات #)
- لا تستخدم نقاط أو نص عريض لرؤوس السيناريو

**فشل تحليل السيناريو الصامت**
- التنسيق الدقيق مطلوب: \`#### Scenario: Name\`
- تصحيح مع: \`openspec show [change] --json --deltas-only\`

### نصائح التحقق

\`\`\`bash
# استخدم دائمًا الوضع الصارم للفحوصات الشاملة
openspec validate [change] --strict

# تصحيح تحليل دلتا
openspec show [change] --json | jq '.deltas'

# تحقق من متطلب محدد
openspec show [spec] --json -r 1
\`\`\`

## سكريبت المسار السعيد

\`\`\`bash
# 1) استكشف الحالة الحالية
openspec spec list --long
openspec list
# بحث نصي كامل اختياري:
# rg -n "Requirement:|Scenario:" openspec/specs
# rg -n "^#|Requirement:" openspec/changes

# 2) اختر معرف التغيير وأنشئ السقالة
CHANGE=add-two-factor-auth
mkdir -p openspec/changes/$CHANGE/{specs/auth}
printf "## لماذا\\n...\\n\\n## ما الذي يتغير\\n- ...\\n\\n## التأثير\\n- ...\\n" > openspec/changes/$CHANGE/proposal.md
printf "## 1. التنفيذ\\n- [ ] 1.1 ...\\n" > openspec/changes/$CHANGE/tasks.md

# 3) أضف الدلتا (مثال)
cat > openspec/changes/$CHANGE/specs/auth/spec.md << 'EOF'
## ADDED Requirements
### Requirement: المصادقة الثنائية
يجب على المستخدمين توفير عامل ثانٍ أثناء تسجيل الدخول.

#### Scenario: OTP مطلوب
- **WHEN** يتم توفير بيانات اعتماد صالحة
- **THEN** تحدي OTP مطلوب
EOF

# 4) التحقق
openspec validate $CHANGE --strict
\`\`\`

## مثال متعدد القدرات

\`\`\`
openspec/changes/add-2fa-notify/
├── proposal.md
├── tasks.md
└── specs/
    ├── auth/
    │   └── spec.md   # ADDED: المصادقة الثنائية
    └── notifications/
        └── spec.md   # ADDED: إشعار OTP بالبريد الإلكتروني
\`\`\`

auth/spec.md
\`\`\`markdown
## ADDED Requirements
### Requirement: المصادقة الثنائية
...
\`\`\`

notifications/spec.md
\`\`\`markdown
## ADDED Requirements
### Requirement: إشعار OTP بالبريد الإلكتروني
...
\`\`\`

## أفضل الممارسات

### البساطة أولاً
- افتراضيًا <100 سطر من الكود الجديد
- تنفيذات ملف واحد حتى يثبت عدم كفايتها
- تجنب الأطر بدون مبرر واضح
- اختر أنماطًا مملة ومثبتة

### محفزات التعقيد
أضف التعقيد فقط مع:
- بيانات الأداء التي تظهر أن الحل الحالي بطيء جدًا
- متطلبات الحجم الملموسة (>1000 مستخدم، >100MB بيانات)
- حالات استخدام متعددة مثبتة تتطلب التجريد

### المراجع الواضحة
- استخدم تنسيق \`file.ts:42\` لمواقع الكود
- راجع المواصفات كـ \`specs/auth/spec.md\`
- اربط التغييرات و PR ذات الصلة

### تسمية القدرات
- استخدم فعل-اسم: \`user-auth\`، \`payment-capture\`
- غرض واحد لكل قدرة
- قاعدة قابلية الفهم في 10 دقائق
- انقسام إذا كانت الوصف يحتاج "AND"

### تسمية معرف التغيير
- استخدم kebab-case، قصير ووصفي: \`add-two-factor-auth\`
- فضّل البادئات بقيادة الفعل: \`add-\`، \`update-\`، \`remove-\`، \`refactor-\`
- تأكد من التفرد؛ إذا تم أخذه، أضف \`-2\`، \`-3\`، إلخ

## دليل اختيار الأدوات

| المهمة | الأداة | لماذا |
|------|------|-----|
| العثور على الملفات حسب النمط | Glob | مطابقة النمط السريع |
| البحث في محتوى الكود | Grep | بحث regex محسّن |
| قراءة ملفات محددة | Read | الوصول المباشر للملف |
| استكشاف نطاق غير معروف | Task | تحقيق متعدد الخطوات |

## استعادة الخطأ

### تعارضات التغيير
1. قم بتشغيل \`openspec list\` لرؤية التغييرات النشطة
2. تحقق من المواصفات المتداخلة
3. تنسيق مع مالكي التغيير
4. النظر في دمج المقترحات

### فشل التحقق
1. قم بتشغيل مع العلم \`--strict\`
2. تحقق من إخراج JSON للتفاصيل
3. تحقق من تنسيق ملف المواصفات
4. تأكد من تنسيق السيناريوهات بشكل صحيح

### نقص السياق
1. اقرأ project.md أولاً
2. تحقق من المواصفات ذات الصلة
3. راجع الأرشيفات الأخيرة
4. اطلب التوضيح

## مرجع سريع

### مؤشرات المرحلة
- \`changes/\` - مقترح، لم يتم بناؤه بعد
- \`specs/\` - تم بناؤه ونشره
- \`archive/\` - التغييرات المكتملة

### أغراض الملفات
- \`proposal.md\` - لماذا وماذا
- \`tasks.md\` - خطوات التنفيذ
- \`design.md\` - القرارات التقنية
- \`spec.md\` - المتطلبات والسلوك

### أساسيات CLI
\`\`\`bash
openspec list              # ما الذي قيد التقدم؟
openspec show [item]       # عرض التفاصيل
openspec validate --strict # هل هو صحيح؟
openspec archive <change-id> [--yes|-y]  # وضع علامة كمكتمل (أضف --yes للأتمتة)
\`\`\`

تذكر: المواصفات هي الحقيقة. التغييرات هي مقترحات. حافظ على مزامنتها.
`;
