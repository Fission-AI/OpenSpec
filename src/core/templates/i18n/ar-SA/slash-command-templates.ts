import { SlashCommandId } from '../../slash-command-templates.js';

const baseGuardrails = `**القيود**
- افضل التنفيذات البسيطة والدنيا أولاً وأضف التعقيد فقط عندما يُطلب أو يكون مطلوبًا بوضوح.
- حافظ على التغييرات محدودة النطاق بشكل وثيق على النتيجة المطلوبة.
- راجع \`openspec/AGENTS.md\` (موجود داخل دليل \`openspec/\`—قم بتشغيل \`ls openspec\` أو \`openspec update\` إذا لم تراه) إذا كنت بحاجة إلى اتفاقيات أو توضيحات OpenSpec إضافية.`;

const proposalGuardrails = `${baseGuardrails}\n- حدد أي تفاصيل غامضة أو غير واضحة واطرح أسئلة المتابعة اللازمة قبل تحرير الملفات.`;

const proposalSteps = `**الخطوات**
1. راجع \`openspec/project.md\`، وقم بتشغيل \`openspec list\` و \`openspec list --specs\`، وافحص الكود أو الوثائق ذات الصلة (مثلًا عبر \`rg\`/\`ls\`) لفهم السلوك الحالي؛ لاحظ أي فجوات تتطلب توضيحًا.
2. اختر \`change-id\` فريدًا بقيادة فعل وأنشئ \`proposal.md\` و \`tasks.md\` و \`design.md\` (عند الحاجة) تحت \`openspec/changes/<id>/\`.
3. اربط التغيير بقدرات أو متطلبات ملموسة، وقسم الجهود متعددة النطاق إلى دلتا مواصفات متميزة بعلاقات وترتيب واضح.
4. التقط المنطق المعماري في \`design.md\` عندما يمتد الحل عبر أنظمة متعددة أو يقدم أنماطًا جديدة أو يتطلب مناقشة مقايضة قبل الالتزام بالمواصفات.
5. اكتب دلتا المواصفات في \`changes/<id>/specs/<capability>/spec.md\` (مجلد واحد لكل قدرة) باستخدام \`## ADDED|MODIFIED|REMOVED Requirements\` مع سيناريو واحد على الأقل \`#### Scenario:\` لكل متطلب ومرجع متقاطع للقدرات ذات الصلة عند الصلة.
6. اكتب \`tasks.md\` كقائمة مرتبة لعناصر عمل صغيرة قابلة للتحقق توفر تقدمًا مرئيًا للمستخدم، وتشمل التحقق (الاختبارات، الأدوات)، وتسليط الضوء على التبعيات أو العمل القابل للتوزيع.
7. تحقق باستخدام \`openspec validate <id> --strict\` وحل جميع المشكلات قبل مشاركة المقترح.`;

const proposalReferences = `**المرجع**
- استخدم \`openspec show <id> --json --deltas-only\` أو \`openspec show <spec> --type spec\` لفحص التفاصيل عند فشل التحقق.
- ابحث عن المتطلبات الموجودة باستخدام \`rg -n "Requirement:|Scenario:" openspec/specs\` قبل كتابة متطلبات جديدة.
- استكشف قاعدة الكود باستخدام \`rg <keyword>\` أو \`ls\` أو قراءات الملفات المباشرة حتى تتماشى المقترحات مع واقع التنفيذ الحالي.`;

const applySteps = `**الخطوات**
تتبع هذه الخطوات كـ TODOs وأكملها واحدة تلو الأخرى.
1. اقرأ \`changes/<id>/proposal.md\` و \`design.md\` (إن وجد) و \`tasks.md\` لتأكيد النطاق ومعايير القبول.
2. اعمل على المهام بالتسلسل، مع الحفاظ على التعديلات بسيطة ومركزة على التغيير المطلوب.
3. أكد الإكمال قبل تحديث الحالات—تأكد من أن كل عنصر في \`tasks.md\` مكتمل.
4. حدّث قائمة التحقق بعد اكتمال كل العمل بحيث يتم تمييز كل مهمة بـ \`- [x]\` وتعكس الواقع.
5. راجع \`openspec list\` أو \`openspec show <item>\` عند الحاجة إلى سياق إضافي.`;

const applyReferences = `**المرجع**
- استخدم \`openspec show <id> --json --deltas-only\` إذا كنت بحاجة إلى سياق إضافي من المقترح أثناء التنفيذ.`;

const archiveSteps = `**الخطوات**
1. حدد معرف التغيير للأرشفة:
   - إذا كانت هذه المطالبة تتضمن بالفعل معرف تغيير محدد (على سبيل المثال داخل كتلة \`<ChangeId>\` مملوءة بوسائط أمر slash)، استخدم تلك القيمة بعد تقليم المسافات البيضاء.
   - إذا كانت المحادثة تشير إلى تغيير بشكل فضفاض (على سبيل المثال بالعنوان أو الملخص)، قم بتشغيل \`openspec list\` لعرض معرفات محتملة، وشارك المرشحين ذوي الصلة، وأكد أي واحد ينوي المستخدم استخدامه.
   - خلاف ذلك، راجع المحادثة، وقم بتشغيل \`openspec list\`، واسأل المستخدم عن التغيير الذي يجب أرشفته؛ انتظر معرف تغيير مؤكد قبل المتابعة.
   - إذا لم تتمكن بعد من تحديد معرف تغيير واحد، توقف وأخبر المستخدم أنه لا يمكنك أرشفة أي شيء بعد.
2. تحقق من معرف التغيير عن طريق تشغيل \`openspec list\` (أو \`openspec show <id>\`) وتوقف إذا كان التغيير مفقودًا أو مؤرشفًا بالفعل أو غير جاهز للأرشفة.
3. قم بتشغيل \`openspec archive <id> --yes\` حتى ينقل CLI التغيير ويطبق تحديثات المواصفات دون مطالبات (استخدم \`--skip-specs\` فقط للعمل المتعلق بالأدوات فقط).
4. راجع إخراج الأمر لتأكيد تحديث المواصفات المستهدفة وهبوط التغيير في \`changes/archive/\`.
5. تحقق باستخدام \`openspec validate --strict\` وافحص باستخدام \`openspec show <id>\` إذا بدا أي شيء غير صحيح.`;

const archiveReferences = `**المرجع**
- استخدم \`openspec list\` لتأكيد معرفات التغيير قبل الأرشفة.
- افحص المواصفات المحدثة باستخدام \`openspec list --specs\` وتناول أي مشاكل تحقق قبل التسليم.`;

export const slashCommandBodies: Record<SlashCommandId, string> = {
  proposal: [proposalGuardrails, proposalSteps, proposalReferences].join('\n\n'),
  apply: [baseGuardrails, applySteps, applyReferences].join('\n\n'),
  archive: [baseGuardrails, archiveSteps, archiveReferences].join('\n\n')
};

export function getSlashCommandBody(id: SlashCommandId): string {
  return slashCommandBodies[id];
}

